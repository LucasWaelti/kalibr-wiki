The [Camera-IMU calibration](Camera-IMU-calibration) routine needs to know how "noisy" your IMU is. This is specified in your [IMU configuration YAML file](yaml-formats) before you start the calibration. Here, you can learn how to set these parameters and how to interpret them.

## The IMU Noise Model

The IMU measurement model used in Kalibr contains two types of sensor errors: <img src="https://latex.codecogs.com/svg.latex?{n}">, an additive noise term that fluctuates very rapidly ("white noise"), and <img src="https://latex.codecogs.com/svg.latex?{b}">, a slowly varying sensor bias. The angular rate measurement <img src="https://latex.codecogs.com/svg.latex?{%5Ctilde%5Comega}"> (in case of a gyro) is therefore written as:

<img src="https://latex.codecogs.com/svg.latex?{%5Ctilde%5Comega(t)=%5Comega(t)+b(t)+n(t)}">.

The same model (with different parameters, as we will later see) is used to model the accelerometer measurement errors. This model is tractable and often used to model inertial sensors [1], [2].

***

**Additive "White Noise"** The rapid fluctuations in the sensor signal are modelled heuristically with an additive, independent, continuous-time white Gaussian noise process <img src="https://latex.codecogs.com/svg.latex?{n(t)}"> of strength <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_g}">:

<img src="https://latex.codecogs.com/svg.latex?{n(t)%5Csim%5Cmathcal%7BN%7D(0,%5Csigma_g^2)}">

<img src="https://latex.codecogs.com/svg.latex?{E[n(t_1)n(t_2)]=%5Csigma_g^2%5Cdelta(t_1-t_2})">

In other words, the higher <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_g}"> is, the more "noisy" your gyro measurements. The parameters `gyroscope_noise_density` and `accelerometer_noise_density` in the [YAML file](yaml-formats) specify exactly these noise strengths <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_g}"> (gyro) and <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_a}"> (accel) for the continuous-time model.

This process can be simulated in discrete-time as follows:

<img src="https://latex.codecogs.com/svg.latex?{n_d[k]=%5Csigma_g_dw[k]}">

with

<img src="https://latex.codecogs.com/svg.latex?{w[k]%5Csim%5Cmathcal%7BN%7D(0,1)}">

<img src="https://latex.codecogs.com/svg.latex?{%5Csigma_g_d=%5Csigma_g%5Cfrac%7B1%7D%7B%5Csqrt%7B%5CDelta%20t%7D%7D}">,

where <img src="https://latex.codecogs.com/svg.latex?{%5CDelta%20t}"> is the sampling time. _Note_: This assumes that the noise was filtered with an ideal low-pass filter that filters noise above <img src="https://latex.codecogs.com/svg.latex?{f=%5Cfrac%7B1%7D%7B%5CDelta%20t%7D}"> (in other words, an ideal decimation stage). This may or may not be the case, depending on your sensor settings. If you simply "subsample" your gyro or accel, you are not allowed to scale your "white noise density" in that way.

How you can determine this parameter for your particular IMU is explained below.

***

**Bias** In Kalibr, low variations in the sensor bias are modelled with a "Brownian motion" process, also termed a "Wiener process", or "random walk" in discrete-time. Heuristically, this process is generated by integrating "white noise" of strength <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_b_g}"> (gyro) or <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_b_a}"> (accel):

<img src="https://latex.codecogs.com/svg.latex?{%5Cdot%7Bb%7D_g=%5Csigma_b_gw}">,

where <img src="https://latex.codecogs.com/svg.latex?{w}"> is "white noise" of unit strength.

The parameters `gyroscope_random_walk` and `accelerometer_random_walk` in the [YAML file](yaml-formats) specify these noise strengths <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_b_g}"> and <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_b_a}">. The higher the bias variations in your gyro or accel are, the higher these parameters need to be set.

This process can be simulated in discrete-time as follows:

<img src="https://latex.codecogs.com/svg.latex?{b_d[k]=b_d[k-1]+%5Csigma_b_g_dw[k]}">

with

<img src="https://latex.codecogs.com/svg.latex?{w[k]%5Csim%5Cmathcal%7BN%7D(0,1)}">

<img src="https://latex.codecogs.com/svg.latex?{%5Csigma_b_g_d=%5Csigma_b_g%5Csqrt%7B%5CDelta%20t%7D}">.

***

Table 1: Summary of the IMU noise model parameters as they can be specified in the [IMU configuration YAML file](yaml-formats).

Parameter | YAML element | Symbol | Units
--- | --- | --- | ---
Gyroscope "white noise" | `gyroscope_noise_density` | <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_g}"> | <img src="https://latex.codecogs.com/svg.latex?{%5Cfrac%7Brad%7D%7Bs%7D%7D%5Cfrac%7B1%7D%7B%5Csqrt%7BHz%7D%7D%7D}">
Accelerometer "white noise" | `accelerometer_noise_density` | <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_a}"> | <img src="https://latex.codecogs.com/svg.latex?{%5Cfrac%7Bm%7D%7Bs^2%7D%7D%5Cfrac%7B1%7D%7B%5Csqrt%7BHz%7D%7D%7D}">
Gyroscope "random walk" | `gyroscope_random_walk` | <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_b_g}"> | <img src="https://latex.codecogs.com/svg.latex?{%5Cfrac%7Brad%7D%7Bs^2%7D%7D%5Cfrac%7B1%7D%7B%5Csqrt%7BHz%7D%7D%7D}">
Accelerometer "random walk" | `accelerometer_random_walk` | <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_b_a}"> | <img src="https://latex.codecogs.com/svg.latex?{%5Cfrac%7Bm%7D%7Bs^3%7D%7D%5Cfrac%7B1%7D%7B%5Csqrt%7BHz%7D%7D%7D}">

***

## How to Obtain the Parameters for your IMU

This section describes how you can obtain the Kalibr IMU noise model parameters for your particular IMU. We focus on how to get the parameters from the datasheet or using the "Allan variance" - but there are many alternative methods available.

### From the Datasheet of the IMU

**White Noise Terms** The parameters for the "white noise" processes (<img src="https://latex.codecogs.com/svg.latex?{%5Csigma_g}">, <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_a}">) are often specified in the datasheet of the sensor manufacturer. A bit misleading, they are commonly denoted as **Angular Random Walk** in case of the gyro, and **Velocity Random Walk** for the accel. The name comes from the fact that if this white noise on rate or acceleration is integrated (in the navigation equations), it becomes a "random walk" on the angle or the velocity.

Other manufacturers specify it directly as **rate noise density**, **acceleration noise density**, or simply **noise density**. The name comes from the fact that <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_g^2}"> corresponds to the power spectral _density_ of <img src="https://latex.codecogs.com/svg.latex?{n}">. The units are often a reliable indicator, but a quick check using the discrete-time implementation outlined above is recommended.

***

**Bias Terms** In contrast to the "white noise sigmas", <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_b_g}"> and <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_b_a}"> are rarely directly specified in the datasheet. The reason is that in practice, the bias does not truly behave like a "random walk" for longer integration times. Often, the so-called **in-run bias (in)stability** is specified instead. This sensor parameter indicates (approximately) the accuracy with which the bias can be determined (if a random process is the sum of "white noise" and a "random walk" bias, the bias can not be estimated with arbitrarily low uncertainty at any point in time). In combination with the strength of the "white noise", however, one can often use the in-run bias stability (the lowest point in the Allan variance) to determine a reasonable parameter for <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_b_a}"> and <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_b_a}"> (assuming that the noise is dominated by "white noise" and a "random walk"). See below.

### From the Allan Variance (AV)

While many (parametric and non-parametric) methods have been proposed to (automatically) determine the noise model parameters from samples, deriving the parameters form an Allan variance plot is probably the most common and standardized procedure. [1] derives the AV for different random processes, including "white noise" (slope -1/2 in a log-log AV plot) and "random walk" (slope +1/2 in a log-log AV plot) that are used in Kalibr. The noise model parameters can be determined directly from the Allan variance.

<img src="https://latex.codecogs.com/svg.latex?{%5Csigma_g}"> and <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_a}"> correspond to the values at <img src="https://latex.codecogs.com/svg.latex?{AV(%5Ctau=1s)}"> (point (1) in the figure below). This is only true since the noise power in most inertial sensors is dominated by "white noise" at a frequency of approx. 1Hz.

<img src="https://latex.codecogs.com/svg.latex?{%5Csigma_b_g}"> and <img src="https://latex.codecogs.com/svg.latex?{%5Csigma_b_a}"> are identified as the value of the (fitted) "random walk" diagonal with <img src="https://latex.codecogs.com/svg.latex?{%5Ctau=3s}"> (point (2) in the figure below). This can be seen immediately when the Allan variance is derived for a "random walk" process.

***

Figure 1: Allan variance of a MEMS gyro with manually identified noise processes.

<img src="https://cloud.githubusercontent.com/assets/1916839/3589506/8f57d0ee-0c4e-11e4-9ab4-33821c040490.png" width="85%" align="middle"/>

***

Some manufacturers provide an Allan variance plot in the datasheet of the device. Otherwise, it needs to be computed from sensor data.

### Kalibr IMU Noise Parameters in Practice

It is important to note that the IMU measurement error model used here is derived from a sensor which does not undergo motion, and at constant temperature. Hence scale factor errors and bias variation caused by temperature changes, for example, are not accounted for. So clearly, the model is optimistic. Particularly when using low-cost MEMS IMUs with Kalibr, you may have to increase the noise model parameters, to "capture" other errors with the model as well. In other words, if you use directly the "sigmas" obtained from static sensor data, Kalibr will tend to trust your IMU measurements too much, and it's solution will not be optimal.

From our experience, for lowest-cost sensors, increasing the noise model parameters by a factor of 10 or more may be necessary. If you use Kalibr with such a device, please give us feedback, such that we can develop specific guidelines, device-specific suggestions, or more advanced methods to determine these parameters.

[1] "IEEE Standard Specification Format Guide and Test Procedure for Single-Axis Interferometric Fiber Optic Gyros",  IEEE Std 952-1997, 1998
http://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=660628&isnumber=14457

[2] "Indirect Kalman Filter for 3D Attitude Estimation", Nikolas Trawny and Stergios I. Roumeliotis, MARS Lab Tech. Report Nr. 2005-002, Rev. 57
http://www-users.cs.umn.edu/~trawny/Publications/Quaternions_3D.pdf
